@model _24DH112073_MyStore.Models.Order
@using System.Linq;

@{
    ViewBag.Title = "XÁC NHẬN ĐƠN HÀNG";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";

    // 1. Tính tổng tiền hàng (chưa có ship)
    decimal productTotal = Model.OrderDetails.Sum(x => x.Quantity * x.UnitPrice);

    // 2. Tính tiền ship = Tổng đơn - Tổng hàng
    decimal shippingFee = Model.TotalAmount - productTotal;
}

<style>
    .success-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .success-icon {
        color: #28a745;
        font-size: 3rem;
        margin-bottom: 10px;
    }

    .order-summary {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #eee;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .dl-horizontal dt {
        float: left;
        width: 180px;
        clear: left;
        text-align: right;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .dl-horizontal dd {
        margin-left: 200px;
        margin-bottom: 5px;
    }

    .total-highlight {
        color: #d70018;
        font-weight: bold;
        font-size: 1.3rem;
    }
</style>

<div class="container" style="margin-top: 20px;">

    <div class="success-header">
        <i class="fa fa-check-circle success-icon"></i>
        <h2 class="text-success">ĐẶT HÀNG THÀNH CÔNG</h2>
        <p>Cảm ơn bạn đã mua sắm! Đơn hàng của bạn đang được xử lý.</p>
    </div>

    <hr />

    <div class="row">
        <div class="col-md-6">
            <div class="order-summary">
                <h4 class="text-primary" style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">Thông tin đơn hàng</h4>
                <dl class="dl-horizontal">
                    <dt>Mã đơn hàng:</dt>
                    <dd>#@Model.OrderID</dd>

                    <dt>Ngày đặt hàng:</dt>
                    <dd>@Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</dd>

                    <dt>Trạng thái:</dt>
                    <dd>@Model.PaymentStatus</dd>

                    <dt>Thanh toán:</dt>
                    <dd>@Model.PaymentMethod</dd>

                    <dt>Vận chuyển:</dt>
                    <dd>@Model.DeliveryMethod</dd>

                    <dt>Địa chỉ giao hàng:</dt>
                    <dd>@Model.ShippingAddress</dd>
                </dl>
            </div>
        </div>
    </div>

    <br />

    <div class="row">
        <div class="col-md-12">
            <h4 class="text-success">Chi tiết sản phẩm</h4>
            <table class="table table-striped table-bordered" style="background-color: #fff;">
                <thead>
                    <tr>
                        <th>Sản phẩm</th>
                        <th class="text-center">Số lượng</th>
                        <th class="text-right">Đơn giá</th>
                        <th class="text-right">Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OrderDetails)
                    {
                        decimal itemTotal = item.Quantity * item.UnitPrice;
                        <tr>
                            <td>
                                @if (item.Product != null)
                                {
                                    @item.Product.ProductName
                                }
                                else
                                {
                                    <span>Sản phẩm không tồn tại</span>
                                }
                            </td>
                            <td class="text-center">@item.Quantity</td>
                            <td class="text-right">
                                @item.UnitPrice.ToString("#,##0", System.Globalization.CultureInfo.GetCultureInfo("en-US")).Replace(',', '.') ₫
                            </td>
                            <td class="text-right">
                                @itemTotal.ToString("#,##0", System.Globalization.CultureInfo.GetCultureInfo("en-US")).Replace(',', '.') ₫
                            </td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    @* DÒNG 1: Tạm tính (Tổng tiền hàng) *@
                    <tr>
                        <td colspan="3" class="text-right">Tạm tính:</td>
                        <td class="text-right">
                            @productTotal.ToString("#,##0", System.Globalization.CultureInfo.GetCultureInfo("en-US")).Replace(',', '.') ₫
                        </td>
                    </tr>

                    @* DÒNG 2: Phí vận chuyển *@
                    <tr>
                        <td colspan="3" class="text-right">Phí vận chuyển (@Model.DeliveryMethod):</td>
                        <td class="text-right">
                            @shippingFee.ToString("#,##0", System.Globalization.CultureInfo.GetCultureInfo("en-US")).Replace(',', '.') ₫
                        </td>
                    </tr>

                    @* DÒNG 3: Tổng cộng *@
                    <tr>
                        <td colspan="3" class="text-right" style="font-size: 1.1rem;"><strong>TỔNG THANH TOÁN:</strong></td>
                        <td class="text-right total-highlight">
                            <strong>@Model.TotalAmount.ToString("#,##0", System.Globalization.CultureInfo.GetCultureInfo("en-US")).Replace(',', '.') ₫</strong>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <p class="text-center" style="margin-top: 30px; margin-bottom: 50px;">
        <a href="@Url.Action("Index", "Home")" class="btn btn-warning btn-lg">
            <i class="fa fa-shopping-basket"></i> Tiếp tục mua hàng
        </a>
    </p>
</div>